<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriScore Wizard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body {
            background-color: #f0f8ff;
        }
        header {
            background-color: #007bff;
            color: white;
        }
        h1 {
            font-size: 2.5rem;
        }
        #nutriscoreForm {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #result {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            text-align: center;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            font-size: 1.5rem;
            color: #007bff;
        }
        footer {
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header class="text-center py-4">
        <h1>NutriScore Wizard</h1>
        <p>Your go-to tool for NutriScore predictions</p>
    </header>

    <div class="container mt-5">
        <div id="nutriscoreForm">
            <h2 class="text-center">Enter Product Information</h2>
            <form>
                <div class="mb-3">
                    <label for="pnns_groups_1" class="form-label">PNNS Group 1</label>
                    <input type="text" class="form-control" id="pnns_groups_1" name="pnns_groups_1" pattern="^[a-zA-Z\s]+$" required>
                    <div class="form-text">Enter text only (e.g., Beverages)</div>
                </div>
                <div class="mb-3">
                    <label for="pnns_groups_2" class="form-label">PNNS Group 2</label>
                    <input type="text" class="form-control" id="pnns_groups_2" name="pnns_groups_2" pattern="^[a-zA-Z\s]+$" required>
                    <div class="form-text">Enter text only (e.g., Sweets)</div>
                </div>
                <div class="mb-3">
                    <label for="energy-kcal_100g" class="form-label">Energy (kcal per 100g)</label>
                    <input type="number" class="form-control" id="energy-kcal_100g" name="energy-kcal_100g" min="0" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="fat_100g" class="form-label">Fat (g per 100g)</label>
                    <input type="number" class="form-control" id="fat_100g" name="fat_100g" min="0" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="saturated-fat_100g" class="form-label">Saturated Fat (g per 100g)</label>
                    <input type="number" class="form-control" id="saturated-fat_100g" name="saturated-fat_100g" min="0" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="carbohydrates_100g" class="form-label">Carbohydrates (g per 100g)</label>
                    <input type="number" class="form-control" id="carbohydrates_100g" name="carbohydrates_100g" min="0" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="sugars_100g" class="form-label">Sugars (g per 100g)</label>
                    <input type="number" class="form-control" id="sugars_100g" name="sugars_100g" min="0" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="fiber_100g" class="form-label">Fiber (g per 100g)</label>
                    <input type="number" class="form-control" id="fiber_100g" name="fiber_100g" min="0" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="proteins_100g" class="form-label">Proteins (g per 100g)</label>
                    <input type="number" class="form-control" id="proteins_100g" name="proteins_100g" min="0" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="salt_100g" class="form-label">Salt (g per 100g)</label>
                    <input type="number" class="form-control" id="salt_100g" name="salt_100g" min="0" step="0.01" required>
                </div>
                <div class="mb-3">
                    <label for="fruits-vegetables-nuts-estimate-from-ingredients_100g" class="form-label">Fruits/Vegetables/Nuts (Estimate per 100g)</label>
                    <input type="number" class="form-control" id="fruits-vegetables-nuts-estimate-from-ingredients_100g" name="fruits-vegetables-nuts-estimate-from-ingredients_100g" min="0" step="0.01" required>
                </div>
                <button type="button" class="btn btn-primary w-100" onclick="getNutriScore()">Get NutriScore</button>
            </form>
        </div>

        <div id="result" class="mt-5" style="display: none;">
            <h2>Predicted NutriScore</h2>
            <p id="score"></p>
            <button class="btn btn-secondary mt-3" onclick="restartForm()">Go Back</button>
        </div>
    </div>

    <footer class="bg-light text-center text-secondary py-3 mt-5">
        <p>&copy; 2024 NutriScore Wizard | Designed for predictive insights on food products</p>
    </footer>

    <!-- jQuery and AJAX script for the button functionality -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        function getNutriScore() {
            if (!document.querySelector("#nutriscoreForm form").checkValidity()) {
                alert("Please fill in all fields correctly.");
                return;
            }
            
            const formData = {
                pnns_groups_1: $('#pnns_groups_1').val(),
                pnns_groups_2: $('#pnns_groups_2').val(),
                "energy-kcal_100g": parseFloat($('#energy-kcal_100g').val()),
                fat_100g: parseFloat($('#fat_100g').val()),
                "saturated-fat_100g": parseFloat($('#saturated-fat_100g').val()),
                carbohydrates_100g: parseFloat($('#carbohydrates_100g').val()),
                sugars_100g: parseFloat($('#sugars_100g').val()),
                fiber_100g: parseFloat($('#fiber_100g').val()),
                proteins_100g: parseFloat($('#proteins_100g').val()),
                salt_100g: parseFloat($('#salt_100g').val()),
                "fruits-vegetables-nuts-estimate-from-ingredients_100g": parseFloat($('#fruits-vegetables-nuts-estimate-from-ingredients_100g').val())
            };

            $.ajax({
                url: "/predict",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(formData),
                success: function(response) {
                    $('#score').text('Your NutriScore: ' + response.prediction);
                    $('#nutriscoreForm').hide();
                    $('#result').show();
                },
                error: function(error) {
                    $('#result').html('<p class="text-danger">Error: ' + error.responseJSON.error + '</p>');
                }
            });
        }

        function restartForm() {
            $('#nutriscoreForm').show();
            $('#result').hide();
            document.querySelector("#nutriscoreForm form").reset();
        }
    </script>
</body>
</html>
